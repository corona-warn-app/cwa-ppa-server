server:
  shutdown: graceful
  ssl:
    enabled: true
    enabled-protocols: TLSv1.2+TLSv1.3
    protocol: TLS
    ciphers: >-
      TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
      TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
      TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
      TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
      TLS_DHE_DSS_WITH_AES_128_GCM_SHA256
      TLS_DHE_DSS_WITH_AES_256_GCM_SHA384
      TLS_DHE_RSA_WITH_AES_128_GCM_SHA256
      TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
      TLS_AES_128_GCM_SHA256
      TLS_AES_256_GCM_SHA384
      TLS_AES_128_CCM_SHA256
    key-password: ${SSL_EDUS_KEYSTORE_PASSWORD}
    key-store: ${SSL_EDUS_KEYSTORE_PATH}
    key-store-password: ${SSL_EDUS_KEYSTORE_PASSWORD}
    key-store-provider: SUN
    key-store-type: JKS
  lifecycle:
    # keep in sync or lower than the kubernetes setting 'terminationGracePeriodSeconds'
    # 5s +5s Feign client + 20s DB timeout
    timeout-per-shutdown-phase: 30s
  transaction:
    default-timeout: 20

spring:
  flyway:
    enabled: true
    locations: classpath:/db/migration, classpath:/db/specific/{vendor}
    schemas: data_donation
  # Postgres configuration
  datasource:
    driver-class-name: org.postgresql.Driver
    #url: jdbc:postgresql://${POSTGRESQL_SERVICE_HOST}:${POSTGRESQL_SERVICE_PORT}/${POSTGRESQL_DATABASE}?ssl=true&sslmode=verify-full&sslrootcert=${SSL_POSTGRES_CERTIFICATE_PATH}&sslcert=${SSL_DISTRIBUTION_CERTIFICATE_PATH}&sslkey=${SSL_DISTRIBUTION_PRIVATE_KEY_PATH}
    url: jdbc:postgresql://localhost:8102/cwa
    username: ${POSTGRESQL_USER_EDUS:postgres}
    password: ${POSTGRESQL_PASSWORD_EDUS:postgres}
    hikari:
      schema: data_donation

services:
  edus:
    configuration-parameters:
      # True to require basicIntegrity for PPAC to pass, false otherwise.
      require-basic-integrity: ${EDUS_ANDROID_REQUIRE_BASIC_INTEGRITY:true}
      # True to require ctsProfileMatch for PPAC to pass, false otherwise.
      require-cts-profile-match: ${EDUS_ANDROID_REQUIRE_CTS_PROFILE_MATCH:true}
      # True to require evaluationType to contain BASIC for PPAC to pass, false otherwise.
      require-evaluation-type-basic: ${EDUS_ANDROID_REQUIRE_EVALUATION_TYPE_BASIC:false}
      # True to require evaluationType to contain HARDWARE_BACKED for PPAC to pass, false otherwise.
      require-evaluation-type-hardware-backed: ${EDUS_ANDROID_REQUIRE_EVALUATION_TYPE_HARDWARE_BACKED:true}
      #The number of hours an OTP is valid for relative to its Created At property. (min value: 0, max value: 768 (32 x 24))
      otp-validity-in-hours: ${EDUS_OTP_VALIDITY_IN_HOURS:168} #7 days x 24 hours

# Actuator configuration
management:
  server:
    ssl:
      enabled: false
  endpoint:
    metrics:
      enabled: true
    prometheus:
      enabled: true
    health:
      probes:
        enabled: true
      group:
        readiness:
          include: db
          show-details: always

logging:
  level:
    org:
      springframework: INFO
    root: INFO
